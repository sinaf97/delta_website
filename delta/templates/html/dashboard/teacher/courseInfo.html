{% include "html/dashboard/teacher/layout.html" %}
{% block main %}



<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h4 class="h4 font-weight-bold">{{user.first_name}} {{user.last_name}}</h4>
  <div class="mb-2 mb-md-0">
      <img src="{{user.pic.url}}" style="width:10%;float:right">
  </div>
</div>
<div id="details">
  <h1 class="h1">{{info.course_name}}</h1>
  <h4>Group: {{info.group}}</h4>
  <h6 class="h6">Semester: {{info.term.season}}{{info.term.part}} of {{info.term.year}}</h6>

  <form id="add-score-form" action="{%url 'add_score'%}" class="form" method="post">
    {%csrf_token%}
     <div class="container" style="margin-top:5%">
         <table class="table table-bordered table-hover">
           <thead class="thead-light">
             <tr>
               <th>Name</th>
               <th>Student Number</th>
               <th>Midterm</th>
               <th>Score</th>
             </tr>
           </thead>
           <tbody id="toFill">
           </tbody>
         </table>
         <input type="text" id="courseInfo" name="course" style="display:none">
         <button type="submit" class="btn btn-primary btn-block" style="margin:5% 0" id="submit">Submit</button>
       </div>
     </form>

   </div>
</main>
<!-- Central Modal Medium Success -->
  <div class="modal fade" id="centralModalSuccess" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-notify modal-success" role="document">
      <!--Content-->
      <div class="modal-content">
        <!--Header-->
        <div class="modal-header">
          <p class="heading lead">Status</p>

          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true" class="white-text">&times;</span>
          </button>
        </div>

        <!--Body-->
        <div class="modal-body">
          <div class="text-center">
            <p id="status-response"></p>
          </div>
        </div>

        <!--Footer-->
        <div class="modal-footer justify-content-center">
          <a type="button" class="btn btn-outline-primary waves-effect" data-dismiss="modal">Close</a>
        </div>
      </div>
      <!--/.Content-->
    </div>
  </div>
  <!-- Central Modal Medium Success-->
{% endblock %}

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

<script type="text/javascript">
var info = {{info|safe}}
var main_course = {{info|safe}}

$('#courseInfo').val(order(main_course))
$('#courses').addClass("active")
$('#courses').attr("aria-expanded","true")
$('#collapseSemester').addClass('show')
$('#collapseYear'+info.term.year).addClass('show')
$('#collapseYearCover'+info.term.year).addClass("active")
$('#'+info.term.year+info.term.season+info.term.part).addClass('active')
$('#collapseTerm'+info.term.year+info.term.season+info.term.part).addClass('show')
$('#'+info.term.year+info.term.season+info.term.part+info.code).addClass("active")

  var students = {{students|safe}}
  var scores = {{scores|safe}}
  var theScore = [0,0]
  for (var i of students) {
    for(var j of scores)
      if(i.username == j.username){
        theScore[0] = j.midScore
        theScore[1] = j.finalScore
        break
      }

    $('#toFill').append(' <tr>\
      <td>'+i.name+'</td>\
      <td>'+i.username+'</td>\
      <td style="width:20%">\
        <input type="number" placeholder="0-100" class="text-center" style="width:40%" name="midterm_'+i.username+'" value="'+theScore[0]+'">\
      </td>\
      <td style="width:20%">\
        <input type="number" placeholder="0-100" class="text-center" style="width:40%" name="final_'+i.username+'" value="'+theScore[1]+'">\
      </td>\
    </tr>')
  }
  var info = {{info|safe}}
  $('#courses').addClass("active")
  $('#courses').attr("aria-expanded","true")
  $('#collapseSemester').addClass('show')

  $('#submit').click(submit_form)

  function submit_form(){
    $('#add-score-form').ajaxForm({
    success: function (data) {
        $('#status-response').html(data.msg)
        $('#centralModalSuccess').modal()

    },
      dataType:'json',
  })
}

</script>
